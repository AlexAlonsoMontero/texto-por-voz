<ion-content [fullscreen]="true">
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-back-button defaultHref="/home" (click)="goBack()" aria-label="Volver a la página principal">
        </ion-back-button>
      </ion-buttons>
      <ion-title>Configuración de Colores</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <div class="settings-container">
      <!-- Selector de tipo de color -->
      <section class="color-type-selector" aria-label="Seleccionar qué color modificar">
        <h2 class="section-title">¿Qué color quieres cambiar?</h2>
        <div class="color-type-grid">
          <button
            *ngFor="let colorType of colorTypes; trackBy: trackByColorType"
            type="button"
            class="color-type-button"
            [class.selected]="selectedColorType?.key === colorType.key"
            [attr.aria-label]="colorType.name + '. ' + colorType.description"
            [attr.aria-pressed]="selectedColorType?.key === colorType.key"
            (click)="selectColorType(colorType)"
            (keydown)="onColorTypeKeyDown($event, colorType)"
          >
            <span class="color-type-icon">{{ colorType.icon }}</span>
            <span class="color-type-name">{{ colorType.name }}</span>
            <div
              class="current-color-preview"
              [style.background-color]="getCurrentColorForType(colorType.key)"
              [attr.aria-label]="'Color actual: ' + getCurrentColorForType(colorType.key)"
            ></div>
          </button>
        </div>
      </section>

      <!-- Paleta de colores integrada -->
      <div
        class="integrated-color-palette"
        *ngIf="selectedColorType"
        [attr.aria-label]="'Paleta de colores para ' + selectedColorType.name"
      >
        <h3 class="palette-title">Selecciona {{ selectedColorType.name }}</h3>
        <div class="predefined-colors-grid">
          <button
            *ngFor="let colorOption of predefinedColors; trackBy: trackByColorOption"
            type="button"
            class="color-button"
            [class.selected]="isSelectedColor(colorOption.value)"
            [style.background-color]="colorOption.value"
            [attr.aria-label]="colorOption.name + '. ' + colorOption.description"
            [attr.aria-pressed]="isSelectedColor(colorOption.value)"
            (click)="onColorSelected({color: colorOption.value, name: colorOption.name})"
            (keydown)="onColorKeyDown($event, colorOption)"
          >
            <span class="color-name">{{ colorOption.name }}</span>
            <span class="color-value">{{ colorOption.value }}</span>
          </button>
        </div>

        <!-- Botón para selector personalizado -->
        <div class="custom-color-section">
          <button
            type="button"
            class="toggle-custom-button"
            [class.active]="showCustomInput"
            aria-label="Alternar selector de color personalizado"
            (click)="toggleCustomInput()"
          >
            {{ showCustomInput ? 'Ocultar' : 'Mostrar' }} Color Personalizado
          </button>

          <div class="custom-input-container" [class.visible]="showCustomInput">
            <input
              type="color"
              class="custom-color-input"
              [value]="selectedColor"
              [attr.aria-label]="selectedColorType.name + ' - Selector de color personalizado'"
              (change)="onCustomColorChange($event)"
            />
            <span class="custom-color-label">Color personalizado</span>
          </div>
        </div>
      </div>

      <!-- Control de duración de presión de botones -->
      <section class="button-duration-section" aria-label="Configuración de duración de presión de botones">
        <h2 class="section-title">⏱️ Tiempo de Presión de Botones</h2>
        <p class="section-description">
          Ajusta cuántos segundos debes mantener presionado un botón antes de que se active
        </p>

        <div class="duration-controls">
          <ion-item lines="full">
            <ion-label position="stacked">
              <strong>Duración actual: {{ pressHoldDuration / 1000 }} segundos</strong>
            </ion-label>
            <ion-range
              [min]="1"
              [max]="5"
              [step]="0.5"
              [value]="pressHoldDuration / 1000"
              [pin]="true"
              [snaps]="true"
              [ticks]="true"
              (ionChange)="onDurationChange($event)"
              aria-label="Ajustar duración de presión de botones en segundos"
            >
              <ion-label slot="start">1s</ion-label>
              <ion-label slot="end">5s</ion-label>
            </ion-range>
          </ion-item>

          <!-- Botones de duración rápida -->
          <div class="quick-duration-buttons">
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 1000"
              (click)="setQuickDuration(1000)"
              aria-label="Establecer duración a 1 segundo"
            >
              1s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 2000"
              (click)="setQuickDuration(2000)"
              aria-label="Establecer duración a 2 segundos"
            >
              2s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 3000"
              (click)="setQuickDuration(3000)"
              aria-label="Establecer duración a 3 segundos"
            >
              3s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 4000"
              (click)="setQuickDuration(4000)"
              aria-label="Establecer duración a 4 segundos"
            >
              4s
            </button>
          </div>
        </div>
      </section>

      <!-- Acciones -->
      <section class="actions-section" aria-label="Acciones de configuración">
        <div class="action-grid">
          <app-press-hold-button
            buttonId="reset-colors"
            color="tertiary"
            ariaLabel="Restablecer todos los colores a valores por defecto"
            (actionExecuted)="resetToDefault()"
          >
            Restablecer por Defecto
          </app-press-hold-button>

          <app-press-hold-button
            buttonId="back-home"
            color="primary"
            ariaLabel="Volver a la página principal"
            (actionExecuted)="goBack()"
          >
            Volver al Inicio
          </app-press-hold-button>
        </div>
      </section>
    </div>
  </ion-content>
</ion-content>
