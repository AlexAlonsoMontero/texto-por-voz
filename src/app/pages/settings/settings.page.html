<ion-content [fullscreen]="true">

  <ion-content [fullscreen]="true">
    <div class="settings-container">
      <!-- Selector de tipo de color -->
      <section class="color-type-selector" aria-label="Seleccionar qu茅 color modificar">
        <h2 class="section-title">驴Qu茅 color quieres cambiar?</h2>
        <div class="color-type-grid">
          <button
            *ngFor="let colorType of colorTypes; trackBy: trackByColorType"
            type="button"
            class="color-type-button"
            [class.selected]="selectedColorType?.key === colorType.key"
            [attr.aria-label]="colorType.name + '. ' + colorType.description"
            [attr.aria-pressed]="selectedColorType?.key === colorType.key"
            (click)="selectColorType(colorType)"
            (keydown)="onColorTypeKeyDown($event, colorType)"
          >
            <span class="color-type-icon">{{ colorType.icon }}</span>
            <span class="color-type-name">{{ colorType.name }}</span>
            <div
              class="current-color-preview"
              [style.background-color]="getCurrentColorForType(colorType.key)"
              [attr.aria-label]="'Color actual: ' + getCurrentColorForType(colorType.key)"
            ></div>
          </button>
        </div>
      </section>

      <!-- Paleta de colores integrada -->
      <div
        class="integrated-color-palette"
        *ngIf="selectedColorType"
        [attr.aria-label]="'Paleta de colores para ' + selectedColorType.name"
      >
        <h3 class="palette-title">Selecciona {{ selectedColorType.name }}</h3>
        <div class="predefined-colors-grid">
          <button
            *ngFor="let colorOption of predefinedColors; trackBy: trackByColorOption"
            type="button"
            class="color-button"
            [class.selected]="isSelectedColor(colorOption.value)"
            [style.background-color]="colorOption.value"
            [attr.aria-label]="colorOption.name + '. ' + colorOption.description"
            [attr.aria-pressed]="isSelectedColor(colorOption.value)"
            (click)="onColorSelected({color: colorOption.value, name: colorOption.name})"
            (keydown)="onColorKeyDown($event, colorOption)"
          >
            <span class="color-name">{{ colorOption.name }}</span>
            <span class="color-value">{{ colorOption.value }}</span>
          </button>
        </div>

        <!-- Bot贸n para selector personalizado -->
        <div class="custom-color-section">
          <button
            type="button"
            class="toggle-custom-button"
            [class.active]="showCustomInput"
            aria-label="Alternar selector de color personalizado"
            (click)="toggleCustomInput()"
          >
            {{ showCustomInput ? 'Ocultar' : 'Mostrar' }} Color Personalizado
          </button>

          <div class="custom-input-container" [class.visible]="showCustomInput">
            <input
              type="color"
              class="custom-color-input"
              [value]="selectedColor"
              [attr.aria-label]="selectedColorType.name + ' - Selector de color personalizado'"
              (change)="onCustomColorChange($event)"
            />
            <span class="custom-color-label">Color personalizado</span>
          </div>
        </div>
      </div>

      <!-- Control de duraci贸n de presi贸n de botones -->
      <section class="button-duration-section" aria-label="Configuraci贸n de duraci贸n de presi贸n de botones">
        <h2 class="section-title">憋 Tiempo de Presi贸n de Botones</h2>
        <p class="section-description">
          Ajusta cu谩ntos segundos debes mantener presionado un bot贸n antes de que se active
        </p>

        <div class="duration-controls">
          <ion-item lines="full">
            <ion-label position="stacked">
              <strong>Duraci贸n actual: {{ pressHoldDuration / 1000 }} segundos</strong>
            </ion-label>
            <ion-range
              [min]="1"
              [max]="5"
              [step]="0.5"
              [value]="pressHoldDuration / 1000"
              [pin]="true"
              [snaps]="true"
              [ticks]="true"
              (ionChange)="onDurationChange($event)"
              aria-label="Ajustar duraci贸n de presi贸n de botones en segundos"
            >
              <ion-label slot="start">1s</ion-label>
              <ion-label slot="end">5s</ion-label>
            </ion-range>
          </ion-item>

          <!-- Botones de duraci贸n r谩pida -->
          <div class="quick-duration-buttons">
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 1000"
              (click)="setQuickDuration(1000)"
              aria-label="Establecer duraci贸n a 1 segundo"
            >
              1s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 2000"
              (click)="setQuickDuration(2000)"
              aria-label="Establecer duraci贸n a 2 segundos"
            >
              2s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 3000"
              (click)="setQuickDuration(3000)"
              aria-label="Establecer duraci贸n a 3 segundos"
            >
              3s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 4000"
              (click)="setQuickDuration(4000)"
              aria-label="Establecer duraci贸n a 4 segundos"
            >
              4s
            </button>
          </div>
        </div>
      </section>

      <!-- Selector de Vista de Escritura -->
      <section class="write-view-section" aria-label="Configuraci贸n de vista de escritura">
        <h2 class="section-title"> Vista de Escritura</h2>
        <p class="section-description">Elige c贸mo visualizar los grupos de letras en la p谩gina de escritura</p>

        <ion-item>
          <ion-label position="stacked">
            <strong>Modo de visualizaci贸n</strong>
          </ion-label>
          <ion-select
            [value]="writeViewMode"
            (ionChange)="onWriteViewChange($event)"
            interface="popover"
            aria-label="Seleccionar modo de vista de escritura"
          >
            <ion-select-option value="panel">Panel (Rejilla 42)</ion-select-option>
            <ion-select-option value="carousel">Carrusel (Deslizar)</ion-select-option>
          </ion-select>
        </ion-item>

        <div class="view-description">
          <div *ngIf="writeViewMode === 'panel'" class="mode-info">
            <p><strong> Modo Panel:</strong> Todos los grupos visibles simult谩neamente en rejilla 42</p>
          </div>
          <div *ngIf="writeViewMode === 'carousel'" class="mode-info">
            <p><strong> Modo Carrusel:</strong> Un grupo por pantalla, desliza con las flechas</p>
          </div>
        </div>
      </section>

      <!-- Configuraci贸n de tiempo de transici贸n del Carrusel -->
      <section
        *ngIf="writeViewMode === 'carousel'"
        class="carousel-delay-section"
        aria-label="Tiempo de transici贸n del carrusel"
      >
        <h2 class="section-title"> Transici贸n del Carrusel</h2>
        <p class="section-description">Ajusta cada cu谩nto cambia el bot贸n autom谩ticamente</p>

        <ion-item lines="full">
          <ion-label position="stacked">
            <strong>Tiempo actual: {{ (carouselDelayMs / 1000) | number:'1.1-1' }} s</strong>
          </ion-label>
          <ion-range
            [min]="0.5"
            [max]="5"
            [step]="0.5"
            [value]="carouselDelayMs / 1000"
            [pin]="true"
            [snaps]="true"
            [ticks]="true"
            (ionChange)="onCarouselDelayChange($event)"
            aria-label="Ajustar tiempo de transici贸n del carrusel en segundos"
          >
            <ion-label slot="start">0,5s</ion-label>
            <ion-label slot="end">5s</ion-label>
          </ion-range>
        </ion-item>
      </section>

      <!-- Acciones -->
      <section class="actions-section" aria-label="Acciones de configuraci贸n">
        <div class="action-grid">
          <app-press-hold-button
            buttonId="reset-colors"
            color="tertiary"
            ariaLabel="Restablecer todos los colores a valores por defecto"
            (actionExecuted)="resetToDefault()"
          >
            Restablecer por Defecto
          </app-press-hold-button>

          <app-press-hold-button
            buttonId="back-home"
            color="primary"
            ariaLabel="Volver a la p谩gina principal"
            (actionExecuted)="goBack()"
          >
            Volver al Inicio
          </app-press-hold-button>
        </div>
      </section>
    </div>
  </ion-content>
</ion-content>
