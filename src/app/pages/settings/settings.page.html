<ion-content [fullscreen]="true">
  <ion-content [fullscreen]="true">
    <div class="settings-container">
      <!-- Selector de tipo de color -->
      <section class="color-type-selector" aria-label="Seleccionar qu√© color modificar">
        <h2 class="section-title">¬øQu√© color quieres cambiar?</h2>
        <div class="color-type-grid">
          <button
            *ngFor="let colorType of colorTypes; trackBy: trackByColorType"
            type="button"
            class="color-type-button"
            [class.selected]="selectedColorType?.key === colorType.key"
            [attr.aria-label]="colorType.name + '. ' + colorType.description"
            [attr.aria-pressed]="selectedColorType?.key === colorType.key"
            (click)="selectColorType(colorType)"
            (keydown)="onColorTypeKeyDown($event, colorType)"
          >
            <span class="color-type-icon">{{ colorType.icon }}</span>
            <span class="color-type-name">{{ colorType.name }}</span>
            <div
              class="current-color-preview"
              [style.background-color]="getCurrentColorForType(colorType.key)"
              [attr.aria-label]="'Color actual: ' + getCurrentColorForType(colorType.key)"
            ></div>
          </button>
        </div>
      </section>

      <!-- Paleta de colores integrada -->
      <div
        class="integrated-color-palette"
        *ngIf="selectedColorType"
        [attr.aria-label]="'Paleta de colores para ' + selectedColorType.name"
      >
        <h3 class="palette-title">Selecciona {{ selectedColorType.name }}</h3>
        <div class="predefined-colors-grid">
          <button
            *ngFor="let colorOption of predefinedColors; trackBy: trackByColorOption"
            type="button"
            class="color-button"
            [class.selected]="isSelectedColor(colorOption.value)"
            [style.background-color]="colorOption.value"
            [attr.aria-label]="colorOption.name + '. ' + colorOption.description"
            [attr.aria-pressed]="isSelectedColor(colorOption.value)"
            (click)="onColorSelected({color: colorOption.value, name: colorOption.name})"
            (keydown)="onColorKeyDown($event, colorOption)"
          >
            <span class="color-name">{{ colorOption.name }}</span>
            <span class="color-value">{{ colorOption.value }}</span>
          </button>
        </div>

        <!-- Bot√≥n para selector personalizado -->
        <div class="custom-color-section">
          <button
            type="button"
            class="toggle-custom-button"
            [class.active]="showCustomInput"
            aria-label="Alternar selector de color personalizado"
            (click)="toggleCustomInput()"
          >
            {{ showCustomInput ? 'Ocultar' : 'Mostrar' }} Color Personalizado
          </button>

          <div class="custom-input-container" [class.visible]="showCustomInput">
            <input
              type="color"
              class="custom-color-input"
              [value]="selectedColor"
              [attr.aria-label]="selectedColorType.name + ' - Selector de color personalizado'"
              (change)="onCustomColorChange($event)"
            />
            <span class="custom-color-label">Color personalizado</span>
          </div>
        </div>
      </div>

      <!-- Control de duraci√≥n de presi√≥n de botones -->
      <section class="button-duration-section" aria-label="Configuraci√≥n de duraci√≥n de presi√≥n de botones">
        <h2 class="section-title">‚è±Ô∏è Tiempo de Presi√≥n de Botones</h2>
        <p class="section-description">
          Ajusta cu√°ntos segundos debes mantener presionado un bot√≥n antes de que se active
        </p>

        <div class="duration-controls">
          <ion-item lines="full">
            <ion-label position="stacked">
              <strong>Duraci√≥n actual: {{ pressHoldDuration / 1000 }} segundos</strong>
            </ion-label>
            <ion-range
              [min]="1"
              [max]="5"
              [step]="0.5"
              [value]="pressHoldDuration / 1000"
              [pin]="true"
              [snaps]="true"
              [ticks]="true"
              (ionChange)="onDurationChange($event)"
              aria-label="Ajustar duraci√≥n de presi√≥n de botones en segundos"
            >
              <ion-label slot="start">1s</ion-label>
              <ion-label slot="end">5s</ion-label>
            </ion-range>
          </ion-item>

          <!-- Botones de duraci√≥n r√°pida -->
          <div class="quick-duration-buttons">
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 1000"
              (click)="setQuickDuration(1000)"
              aria-label="Establecer duraci√≥n a 1 segundo"
            >
              1s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 2000"
              (click)="setQuickDuration(2000)"
              aria-label="Establecer duraci√≥n a 2 segundos"
            >
              2s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 3000"
              (click)="setQuickDuration(3000)"
              aria-label="Establecer duraci√≥n a 3 segundos"
            >
              3s
            </button>
            <button
              type="button"
              class="quick-button"
              [class.selected]="pressHoldDuration === 4000"
              (click)="setQuickDuration(4000)"
              aria-label="Establecer duraci√≥n a 4 segundos"
            >
              4s
            </button>
          </div>
        </div>
      </section>

      <!-- Selector de Vista de Escritura -->
      <section class="write-view-section" aria-label="Configuraci√≥n de vista de escritura">
        <h2 class="section-title">üìù Vista de Escritura</h2>
        <p class="section-description">Elige c√≥mo visualizar los grupos de letras en la p√°gina de escritura</p>

        <ion-item>
          <ion-label position="stacked">
            <strong>Modo de visualizaci√≥n</strong>
          </ion-label>
          <ion-select
            [value]="writeViewMode"
            (ionChange)="onWriteViewChange($event)"
            interface="popover"
            aria-label="Seleccionar modo de vista de escritura"
          >
            <ion-select-option value="panel">Panel (Rejilla 4√ó2)</ion-select-option>
            <ion-select-option value="carousel">Carrusel (Deslizar)</ion-select-option>
          </ion-select>
        </ion-item>

        <div class="view-description">
          <div *ngIf="writeViewMode === 'panel'" class="mode-info">
            <p><strong>üìä Modo Panel:</strong> Todos los grupos visibles simult√°neamente en rejilla 4√ó2</p>
          </div>
          <div *ngIf="writeViewMode === 'carousel'" class="mode-info">
            <p><strong>üîÑ Modo Carrusel:</strong> Un grupo por pantalla, desliza con las flechas</p>
          </div>
        </div>
      </section>

      <!-- Configuraci√≥n de tiempo de transici√≥n del Carrusel -->
      <section
        *ngIf="writeViewMode === 'carousel'"
        class="carousel-delay-section"
        aria-label="Tiempo de transici√≥n del carrusel"
      >
        <h2 class="section-title">üåÄ Transici√≥n del Carrusel</h2>
        <p class="section-description">Ajusta cada cu√°nto cambia el bot√≥n autom√°ticamente</p>

        <ion-item lines="full">
          <ion-label position="stacked">
            <strong>Tiempo actual: {{ (carouselDelayMs / 1000) | number:'1.1-1' }} s</strong>
          </ion-label>
          <ion-range
            [min]="0.5"
            [max]="5"
            [step]="0.5"
            [value]="carouselDelayMs / 1000"
            [pin]="true"
            [snaps]="true"
            [ticks]="true"
            (ionChange)="onCarouselDelayChange($event)"
            aria-label="Ajustar tiempo de transici√≥n del carrusel en segundos"
          >
            <ion-label slot="start">0,5s</ion-label>
            <ion-label slot="end">5s</ion-label>
          </ion-range>
        </ion-item>
      </section>

      <!-- üÜï Configuraci√≥n de Botones de Frases -->
      <section class="phrase-buttons-section" aria-label="Configuraci√≥n de botones de frases">
        <h2 class="section-title">üîò Botones de Frases Predefinidas</h2>
        <p class="section-description">Configura el n√∫mero y tama√±o de los botones de frases</p>

        <div class="button-config-info">
          <p><strong>Configuraci√≥n actual:</strong></p>
          <p>üìä {{ buttonCount }} botones de tama√±o {{ getSizeLabel(buttonSize) }}</p>
          <p>üìù {{ currentPhraseCount }} frases guardadas</p>
        </div>

        <ion-item>
          <ion-label position="stacked">
            <strong>N√∫mero de botones</strong>
          </ion-label>
          <ion-select
            [(ngModel)]="buttonCount"
            interface="popover"
            aria-label="Seleccionar n√∫mero de botones"
          >
            <ion-select-option *ngFor="let count of availableButtonCounts" [value]="count">
              {{ count }} botones
            </ion-select-option>
          </ion-select>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">
            <strong>Tama√±o de botones</strong>
          </ion-label>
          <ion-select
            [(ngModel)]="buttonSize"
            interface="popover"
            aria-label="Seleccionar tama√±o de botones"
          >
            <ion-select-option *ngFor="let size of buttonSizes" [value]="size.value">
              {{ size.label }}
            </ion-select-option>
          </ion-select>
        </ion-item>

        <div class="apply-button-container">
          <app-press-hold-button
            buttonId="apply-button-config"
            color="primary"
            ariaLabel="Aplicar configuraci√≥n de botones"
            (actionExecuted)="applyButtonConfig()"
          >
            ‚úì Aplicar Cambios
          </app-press-hold-button>
        </div>
      </section>

      <!-- Acciones -->
      <section class="actions-section" aria-label="Acciones de configuraci√≥n">
        <div class="action-grid">
          <app-press-hold-button
            buttonId="reset-colors"
            color="tertiary"
            ariaLabel="Restablecer todos los colores a valores por defecto"
            (actionExecuted)="resetToDefault()"
          >
            Restablecer por Defecto
          </app-press-hold-button>

          <app-press-hold-button
            buttonId="back-home"
            color="primary"
            ariaLabel="Volver a la p√°gina principal"
            (actionExecuted)="goBack()"
          >
            Volver al Inicio
          </app-press-hold-button>
        </div>
      </section>
    </div>
  </ion-content>
</ion-content>
