<ion-content [fullscreen]="true">
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-back-button defaultHref="/home" (click)="goBack()" aria-label="Volver a la página principal">
        </ion-back-button>
      </ion-buttons>
      <ion-title>Configuración de Colores</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <div class="settings-container">
      <!-- Selector de tipo de color -->
      <section class="color-type-selector" aria-label="Seleccionar qué color modificar">
        <h2 class="section-title">¿Qué color quieres cambiar?</h2>
        <div class="color-type-grid">
          <button
            *ngFor="let colorType of colorTypes; trackBy: trackByColorType"
            type="button"
            class="color-type-button"
            [class.selected]="selectedColorType?.key === colorType.key"
            [attr.aria-label]="colorType.name + '. ' + colorType.description"
            [attr.aria-pressed]="selectedColorType?.key === colorType.key"
            (click)="selectColorType(colorType)"
            (keydown)="onColorTypeKeyDown($event, colorType)"
          >
            <span class="color-type-icon">{{ colorType.icon }}</span>
            <span class="color-type-name">{{ colorType.name }}</span>
            <div
              class="current-color-preview"
              [style.background-color]="getCurrentColorForType(colorType.key)"
              [attr.aria-label]="'Color actual: ' + getCurrentColorForType(colorType.key)"
            ></div>
          </button>
        </div>
      </section>

      <!-- Paleta de colores integrada -->
      <div
        class="integrated-color-palette"
        *ngIf="selectedColorType"
        [attr.aria-label]="'Paleta de colores para ' + selectedColorType.name"
      >
        <h3 class="palette-title">Selecciona {{ selectedColorType.name }}</h3>
        <div class="predefined-colors-grid">
          <button
            *ngFor="let colorOption of predefinedColors; trackBy: trackByColorOption"
            type="button"
            class="color-button"
            [class.selected]="isSelectedColor(colorOption.value)"
            [style.background-color]="colorOption.value"
            [attr.aria-label]="colorOption.name + '. ' + colorOption.description"
            [attr.aria-pressed]="isSelectedColor(colorOption.value)"
            (click)="onColorSelected({color: colorOption.value, name: colorOption.name})"
            (keydown)="onColorKeyDown($event, colorOption)"
          >
            <span class="color-name">{{ colorOption.name }}</span>
            <span class="color-value">{{ colorOption.value }}</span>
          </button>
        </div>

        <!-- Botón para selector personalizado -->
        <div class="custom-color-section">
          <button
            type="button"
            class="toggle-custom-button"
            [class.active]="showCustomInput"
            aria-label="Alternar selector de color personalizado"
            (click)="toggleCustomInput()"
          >
            {{ showCustomInput ? 'Ocultar' : 'Mostrar' }} Color Personalizado
          </button>

          <div class="custom-input-container" [class.visible]="showCustomInput">
            <input
              type="color"
              class="custom-color-input"
              [value]="selectedColor"
              [attr.aria-label]="selectedColorType.name + ' - Selector de color personalizado'"
              (change)="onCustomColorChange($event)"
            />
            <span class="custom-color-label">Color personalizado</span>
          </div>
        </div>
      </div>

      <!-- Acciones -->
      <section class="actions-section" aria-label="Acciones de configuración">
        <div class="action-grid">
          <app-press-hold-button
            buttonId="reset-colors"
            [holdDuration]="3000"
            color="tertiary"
            ariaLabel="Restablecer todos los colores a valores por defecto"
            (actionExecuted)="resetToDefault()"
          >
            Restablecer por Defecto
          </app-press-hold-button>

          <app-press-hold-button
            buttonId="back-home"
            [holdDuration]="2000"
            color="primary"
            ariaLabel="Volver a la página principal"
            (actionExecuted)="goBack()"
          >
            Volver al Inicio
          </app-press-hold-button>
        </div>
      </section>
    </div>
  </ion-content>
</ion-content>
