<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <app-press-hold-button
        (pressed)="onBackAction('back')"
        label="Volver"
        ariaLabel="Volver a la página principal"
        customClass="header-back-button"
      >
        <ion-icon name="arrow-back-outline"></ion-icon>
      </app-press-hold-button>
    </ion-buttons>
    <ion-title>Configuración</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="settings-wrapper">
    <!-- SECCIÓN: APARIENCIA -->
    <ion-list-header>
      <ion-label>Apariencia</ion-label>
    </ion-list-header>
    <ion-accordion-group expand="inset">
      <ion-accordion value="colors">
        <ion-item slot="header">
          <ion-icon slot="start" name="color-palette-outline" color="primary"></ion-icon>
          <ion-label>
            <h2>Colores del Tema</h2>
            <p>Personaliza los colores de la aplicación</p>
          </ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <!-- Selector de Tipo de Color -->
          <ion-segment
            [value]="selectedColorType?.key"
            scrollable="true"
            (ionChange)="selectColorTypeByKey($event)"
            mode="ios"
            class="color-type-segment"
          >
            <ion-segment-button *ngFor="let type of colorTypes" [value]="type.key">
              <ion-label>{{ type.name }}</ion-label>
            </ion-segment-button>
          </ion-segment>

          <div
            class="current-color-indicator"
            *ngIf="selectedColorType"
            [style.background-color]="getCurrentColorForType(selectedColorType.key)"
          >
            <p>{{ selectedColorType.description }}</p>
          </div>

          <!-- Paleta de Colores -->
          <div class="palette-grid" *ngIf="selectedColorType">
            <button
              *ngFor="let colorOption of predefinedColors; trackBy: trackByColorOption"
              type="button"
              class="color-circle"
              [class.selected]="isSelectedColor(colorOption.value)"
              [style.background-color]="colorOption.value"
              [attr.aria-label]="colorOption.name"
              (click)="onColorSelected({color: colorOption.value, name: colorOption.name})"
            >
              <ion-icon name="checkmark-circle-outline" *ngIf="isSelectedColor(colorOption.value)"></ion-icon>
            </button>
          </div>

          <!-- Color Personalizado -->
          <div class="custom-color-row">
            <ion-button fill="outline" size="small" (click)="toggleCustomInput()">
              {{ showCustomInput ? 'Ocultar' : 'Usar' }} Color Personalizado
            </ion-button>
            <div class="custom-input-wrapper" *ngIf="showCustomInput">
              <input
                type="color"
                [value]="selectedColor"
                (change)="onCustomColorChange($event)"
                aria-label="Selector de color personalizado"
              />
            </div>
          </div>

          <ion-button expand="block" fill="clear" color="medium" (click)="resetToDefault()">
            Restaurar colores por defecto
          </ion-button>
        </div>
      </ion-accordion>
    </ion-accordion-group>

    <!-- SECCIÓN: ACCESIBILIDAD -->
    <ion-list-header>
      <ion-label>Accesibilidad</ion-label>
    </ion-list-header>
    <ion-accordion-group expand="inset">
      <!-- Tiempo de Presión -->
      <ion-accordion value="duration">
        <ion-item slot="header">
          <ion-icon slot="start" name="time-outline" color="secondary"></ion-icon>
          <ion-label>
            <h2>Tiempo de Presión</h2>
            <p>Ajusta la duración para activar botones</p>
          </ion-label>
          <ion-note slot="end">{{ pressHoldDuration / 1000 }}s</ion-note>
        </ion-item>
        <div class="ion-padding" slot="content">
          <div class="range-container">
            <ion-range
              [min]="0.5"
              [max]="5"
              [step]="0.5"
              [value]="pressHoldDuration / 1000"
              [pin]="true"
              [snaps]="true"
              [ticks]="true"
              (ionChange)="onDurationChange($event)"
            >
              <ion-icon slot="start" size="small" name="time-outline"></ion-icon>
              <ion-icon slot="end" size="large" name="time-outline"></ion-icon>
            </ion-range>
            <div class="range-labels">
              <span>Rápido (0.5s)</span>
              <span>Lento (5s)</span>
            </div>
          </div>
        </div>
      </ion-accordion>

      <!-- Tamaño de Botones -->
      <ion-accordion value="buttonSize">
        <ion-item slot="header">
          <ion-icon slot="start" name="resize-outline" color="primary"></ion-icon>
          <ion-label>
            <h2>Tamaño de Botones</h2>
            <p>Tamaño de los botones de frases</p>
          </ion-label>
          <ion-note slot="end">{{ getSizeLabel(buttonSize) }}</ion-note>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-segment [value]="buttonSize" (ionChange)="buttonSize = $any($event.detail.value); applyButtonConfig()">
            <ion-segment-button value="small">
              <ion-label>Peq</ion-label>
            </ion-segment-button>
            <ion-segment-button value="medium">
              <ion-label>Med</ion-label>
            </ion-segment-button>
            <ion-segment-button value="large">
              <ion-label>Gra</ion-label>
            </ion-segment-button>
            <ion-segment-button value="xlarge">
              <ion-label>Xtra</ion-label>
            </ion-segment-button>
          </ion-segment>
        </div>
      </ion-accordion>
    </ion-accordion-group>

    <!-- SECCIÓN: INTERFAZ -->
    <ion-list-header>
      <ion-label>Interfaz</ion-label>
    </ion-list-header>
    <ion-accordion-group expand="inset">
      <!-- Modo de Vista -->
      <ion-accordion value="viewMode">
        <ion-item slot="header">
          <ion-icon slot="start" name="layers-outline" color="secondary"></ion-icon>
          <ion-label>
            <h2>Modo de Vista</h2>
            <p>Panel o Carrusel</p>
          </ion-label>
          <ion-note slot="end">{{ writeViewMode === 'panel' ? 'Panel' : 'Carrusel' }}</ion-note>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-segment [value]="writeViewMode" (ionChange)="onWriteViewChange($event)">
            <ion-segment-button value="panel">
              <ion-icon name="grid-outline"></ion-icon>
              <ion-label>Panel</ion-label>
            </ion-segment-button>
            <ion-segment-button value="carousel">
              <ion-icon name="layers-outline"></ion-icon>
              <ion-label>Carrusel</ion-label>
            </ion-segment-button>
          </ion-segment>
          <p class="helper-text ion-padding-top">
            {{ writeViewMode === 'panel' ? 'Muestra todas las frases en una cuadrícula.' : 'Muestra las frases una por
            una deslizándolas.' }}
          </p>
        </div>
      </ion-accordion>

      <!-- Velocidad Carrusel (Solo si es carrusel) -->
      <ion-accordion value="carouselSpeed" [disabled]="writeViewMode !== 'carousel'">
        <ion-item slot="header">
          <ion-icon
            slot="start"
            name="speedometer-outline"
            [color]="writeViewMode === 'carousel' ? 'primary' : 'medium'"
          ></ion-icon>
          <ion-label>
            <h2>Velocidad Carrusel</h2>
            <p>Tiempo de transición automática</p>
          </ion-label>
          <ion-note slot="end">{{ carouselDelayMs / 1000 }}s</ion-note>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-range
            [min]="0.5"
            [max]="5"
            [step]="0.5"
            [value]="carouselDelayMs / 1000"
            [pin]="true"
            [ticks]="true"
            [snaps]="true"
            (ionChange)="onCarouselDelayChange($event)"
          >
            <ion-icon slot="start" size="small" name="time-outline"></ion-icon>
            <ion-icon slot="end" size="large" name="time-outline"></ion-icon>
          </ion-range>
        </div>
      </ion-accordion>

      <!-- Cantidad de Botones -->
      <ion-accordion value="buttonCount">
        <ion-item slot="header">
          <ion-icon slot="start" name="grid-outline" color="secondary"></ion-icon>
          <ion-label>
            <h2>Cantidad de Botones</h2>
            <p>Número de frases visibles</p>
          </ion-label>
          <ion-note slot="end">{{ buttonCount }}</ion-note>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-select
            [value]="buttonCount"
            (ionChange)="buttonCount = $event.detail.value; applyButtonConfig()"
            interface="action-sheet"
            placeholder="Seleccionar cantidad"
          >
            <ion-select-option *ngFor="let count of availableButtonCounts" [value]="count">
              {{ count }} botones
            </ion-select-option>
          </ion-select>
          <p class="helper-text ion-padding-top">
            Define cuántos botones de frases se muestran en la pantalla de escritura.
          </p>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </div>
</ion-content>
